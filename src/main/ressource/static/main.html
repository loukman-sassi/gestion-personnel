<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion Personnels</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="text-center mb-4">Tableau de Bord - Gestion Personnels</h1>

    <div class="card mb-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <span>Liste des Professeurs</span>
            <div class="bg-primary text-white d-flex justify-content-end">
            	<button onclick="chargerProfesseurs()" class="btn btn-sm btn-light text-primary mx-2">Actualiser</button>
            	<a href="ajouter_professeur.html" class="btn btn-sm btn-light text-primary">Nouveau Professeur</a>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Diplôme</th>
                        <th>Modules</th>
                        <th>Actions</th> </tr>
                </thead>
                <tbody id="tableProfs">
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <span>Liste des Assistants</span>  
            <div class="bg-info text-white d-flex justify-content-end">
            	<button onclick="chargerAssistants()" class="btn btn-sm btn-light text-info mx-2">Actualiser</button>
            	<a href="ajouter_assistant.html" class="btn btn-sm btn-light text-info">Nouveau Assistant</a>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Diplôme</th>
                        <th>Responsable</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableAssistants">
                    </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
            <span>Liste des Modules</span>
            <div class="bg-success text-white d-flex justify-content-end">
            	<button onclick="chargerModules()" class="btn btn-sm btn-light text-success mx-2">Actualiser</button>
            	<a href="ajouter_module.html" class="btn btn-sm btn-light text-success">Nouveau Module</a>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Titre</th>
                        <th>Cours (h)</th>
                        <th>TD (h)</th> <th>TP (h)</th> <th>Responsable</th>
                        <th>Actions</th> 
                    </tr>
                </thead>
                <tbody id="tableModules"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const API_URL = "http://localhost:8080/api";

    function chargerProfesseurs() {
        fetch(API_URL + "/professeurs/index")
            .then(response => response.json())
            .then(data => {
                let html = "";
                data.forEach(professeur => {
                	let modulesList = "";
                    if (professeur.modules && professeur.modules.length > 0) {
                        modulesList = professeur.modules.map(module => 
                            `<span class="badge badge-secondary mr-1">${module.titre}</span>`
                        ).join(" ");
                    } else {
                        modulesList = '<span class="text-muted">Aucun module</span>';
                    }
                    html += `
                        <tr>
                            <td>${professeur.id}</td>
                            <td>${professeur.nom}</td>
                            <td>${professeur.prenom}</td>
                            <td>${professeur.diplome}</td>
                            <td>${modulesList}</td>
                            <td>
                                <a href="ajouter_professeur.html?id=${professeur.id}" class="btn btn-sm btn-warning">Modifier</a>
                                <button onclick="supprimerProf(${professeur.id})" class="btn btn-sm btn-danger">Supprimer</button>
                            </td>
                        </tr>
                    `;
                });
                document.getElementById("tableProfs").innerHTML = html;
            })
            .catch(error => console.error("Erreur:", error));
    }

    function supprimerProf(id) {
        if (confirm("Voulez-vous vraiment supprimer ce professeur ?")) {
            fetch(API_URL + "/professeurs/delete/" + id, {
                method: "DELETE"
            })
            .then(response => {
                if (response.ok) {
                    alert("Professeur supprimé !");
                    chargerProfesseurs(); 
                } else {
                    alert("Erreur lors de la suppression");
                }
            });
        }
    }
    
    function chargerAssistants() {
        fetch(API_URL + "/assistants/index")
            .then(response => response.json()) 
            .then(data => {
                let html = "";
                data.forEach(assistant => {
                	let nomResponsable = assistant.responsable ? assistant.responsable.nom : "Aucun";
                    html += `
                        <tr>
                            <td>${assistant.id}</td>
                            <td>${assistant.nom}</td>
                            <td>${assistant.prenom}</td>
                            <td>${assistant.diplome}</td>
                            <td>${nomResponsable}</td>
                            <td>
                            	<a href="ajouter_assistant.html?id=${assistant.id}" class="btn btn-sm btn-warning">Modifier</a>
                            	<button onclick="supprimerAssistant(${assistant.id})" class="btn btn-sm btn-danger">Supprimer</button>
                            </td>
                        </tr>
                    `;
                });
                document.getElementById("tableAssistants").innerHTML = html;
            })
            .catch(error => console.error("Erreur:", error));
    }
    
    function supprimerAssistant(id) {
        if (confirm("Voulez-vous vraiment supprimer l'assistant ?")) {
            fetch(API_URL + "/assistants/delete/" + id, {
                method: "DELETE"
            })
            .then(response => {
                if (response.ok) {
                    alert("Assistant supprimé !");
                    chargerAssistants(); 
                } else {
                    alert("Erreur lors de la suppression");
                }
            });
        }
    }

    function chargerModules() {
        fetch(API_URL + "/modules/index")
            .then(response => response.json())
            .then(data => {
                let html = "";
                data.forEach(module => {
                    let nomResponsable = module.responsable ? module.responsable.nom : "Aucun";
                    html += `
                        <tr>
                            <td>${module.idModule}</td> 
                            <td>${module.titre}</td>
                            <td>${module.nombreHeuresCours}</td>
                            <td>${module.nombreHeuresTd}</td>
                            <td>${module.nombreHeuresTp}</td>
                            <td><span class="badge badge-info">${nomResponsable}</span></td>
                            <td>
                                <a href="ajouter_module.html?id=${module.idModule}" class="btn btn-sm btn-warning">Modifier</a>
                                <button onclick="supprimerModule(${module.idModule})" class="btn btn-sm btn-danger">Supprimer</button>
                            </td>
                        </tr>
                    `;
                });
                document.getElementById("tableModules").innerHTML = html;
            });
    }

    function supprimerModule(id) {
        if (confirm("Voulez-vous vraiment supprimer ce module ?")) {
            fetch(API_URL + "/modules/delete/" + id, { method: "DELETE" })
            .then(res => {
                if(res.ok) {
                    chargerModules(); 
                } else {
                    alert("Erreur suppression");
                }
            });
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        chargerProfesseurs();
        chargerAssistants();
        chargerModules();
    });
</script>

</body>
</html>